/*!
 * quickhybrid v0.0.1
 * (c) 2017-2017 dailc
 * Released under the BSD-3-Clause License.
 * https://github.com/quickhybrid/quickhybrid
 */
!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):e.quick=o()}(this,function(){"use strict";function e(e){(function(e){this.os={};var o=e.match(/(Android);?[\s/]+([\d.]+)?/);o&&(this.os.android=!0,this.os.version=o[2],this.os.isBadAndroid=!/Chrome\/\d/.test(window.navigator.appVersion));var r=e.match(/(iPhone\sOS)\s([\d_]+)/);r&&(this.os.ios=!0,this.os.iphone=!0,this.os.version=r[2].replace(/_/g,"."));var n=e.match(/(iPad).*OS\s([\d_]+)/);n&&(this.os.ios=!0,this.os.ipad=!0,this.os.version=n[2].replace(/_/g,"."));var t=e.match(/QuickHybrid/i);t&&(this.os.quick=!0);var i=e.match(/EpointEJS/i);i&&(this.os.ejs=!0);var a=e.match(/DingTalk/i);a&&(this.os.dd=!0),i||a||t||(this.os.h5=!0)}).call(e,navigator.userAgent)}function o(e){var o=e;o.Promise=window.Promise,o.getPromise=function(){return o.Promise},o.setPromise=function(e){o.Promise=e}}function r(e){console.error("[quick error]: "+e)}function n(e){console.log("[quick log]: "+e)}function t(e){var o=e,n=void 0;o.showError=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"错误!";r("code:"+e+", msg:"+o),n&&n({code:e,message:o})},o.globalError=g,o.error=function(e){n=e}}function i(e){function o(e,o){this.api=e,this.callback=o}var r=e;o.prototype.walk=function(){var e=this,o=r.getPromise();return function(){for(var r=arguments.length,n=Array(r),t=0;t<r;t++)n[t]=arguments[t];var i=n;i[0]=i[0]||{},e.api.defaultParams&&i[0]instanceof Object&&Object.keys(e.api.defaultParams).forEach(function(o){void 0===i[0][o]&&(i[0][o]=e.api.defaultParams[o])});var a=void 0;return e.callback&&(a=e.callback),o?a&&new o(function(o,r){i=i.concat([o,r]),a.apply(e,i)}):a&&a.apply(e,i)}},o.prototype.dispose=function(){this.api=null,this.callback=null},r.Proxy=o}function a(e){function o(){return Math.floor(Math.random()*O)}function n(e){return"string"!=typeof e?JSON.stringify(e):e}function t(e,o){var r=d+"://"+e,t=void 0,i=void 0,a=void 0;return o.callbackId&&(t=o.callbackId,i=o.handlerName,a=o.data),a=encodeURIComponent(n(a)),r+=":"+t+"/"+i+"?"+a}function i(e,n,i){var a=n;if("function"==typeof i){var s=o();f[s]=i,a.callbackId=s}else a.callbackId=i;var c=t(e,a);R.quick?R.ios?window.webkit.messageHandlers.WKWebViewJavascriptBridge.postMessage(c):window.top.prompt(c,""):r("浏览器中jsbridge无效,对应scheme:"+c)}var a=e,s={},c=a.showError,u=a.globalError,R=a.os;a.JSBridge=s;var d="QuickHybridJSBridge",E={},f={},l={},O=2147483647;s.registerHandler=function(e,o){E[e]=o},s.registerLongCallback=function(e,o){l[e]=o},s.getLongCallbackId=function(){return O-=1},s.callHandler=function(e,o,r,n){i(e,{handlerName:o,data:r},n)},s._handleMessageFromNative=function(e){setTimeout(function(){var o=void 0;try{"string"==typeof e?(o=decodeURIComponent(e),o=JSON.parse(o)):o=e}catch(e){return void c(u.ERROR_TYPE_NATIVECALL.code,u.ERROR_TYPE_NATIVECALL.msg)}var r=o.responseId,n=o.responseData,t=void 0;if(r)(t=(t=f[r])||l[r])&&t(n),delete f[r];else{var i=E[o.handlerName],a=o.data;i&&i(a)}})}}function s(e){return"Object"===Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]}function c(e){for(var o=e,r=arguments.length,n=Array(r>1?r-1:0),t=1;t<r;t++)n[t-1]=arguments[t];return n.forEach(function(e){Object.keys(e).forEach(function(r){o[r]=e[r]})}),o}function u(e,o){if("string"!=typeof e||"string"!=typeof o)throw new Error("version need to be string type");for(var r=e.split("."),n=o.split("."),t=Math.max(r.length,n.length),i=0;i<t;i+=1){var a=r[i]||0,s=n[i]||0;if(a-=0,s-=0,a>s)return 1;if(a<s)return-1}return 0}function R(e){return function(o,r,n){var t=o.success,i=o.error,a=o.dataFilter,s=o.proto,c=o.handlerName,u=o.isLongCb,R=o.isEvent,d=o.data,E=function(e){if(0===e.code)i&&i(e),!u&&n&&n(e);else{var o=e;a&&(o=a(o)),t&&t(o.result),!u&&r&&r(o.result)}};if(u){var f=e.getLongCallbackId();R&&(d.port=f),e.registerLongCallback(f,E),e.callHandler(s,c,d,f),r&&r()}else e.callHandler(s,c,d,E)}}function d(e){var o=e,r=o.os,n=R(o.JSBridge);o.callInner=function(e,o,t){var i=c({},e);i.success=void 0,i.error=void 0,i.dataFilter=void 0,r.quick&&n({handlerName:this.api.namespace,data:i,proto:this.api.moduleName,success:e.success,error:e.error,dataFilter:e.dataFilter,isLongCb:this.api.isLongCb,isEvent:this.api.isEvent},o,t)}}function E(e){function o(e){for(var o=0,r=l.length;o<r;o+=1)if(e[l[o]])return l[o];return"h5"}function r(e,o){var r=e;return(/[.]/.test(o)?o.replace(/[.][^.]+$/,"").split("."):[]).forEach(function(e){r[e]=r[e]||{},r=r[e]}),r}function n(e,r,n,t){Object.defineProperty(e,r,{configurable:!0,enumerable:!0,get:function(){var e=E[n][o(R)];if(e)return e.walk();var r=t.os?t.os.join("或"):'"非法"',i=t.namespace+"要求的os环境为:"+r;return u(c.ERROR_TYPE_APIOS.code,i),v},set:function(){u(c.ERROR_TYPE_APIMODIFY.code,c.ERROR_TYPE_APIMODIFY.msg)}})}function t(e){Object.defineProperty(a,e,{configurable:!0,enumerable:!0,get:function(){return f[e]||(f[e]={}),f[e]},set:function(){u(c.ERROR_TYPE_MODULEMODIFY.code,c.ERROR_TYPE_MODULEMODIFY.msg)}})}function i(e,o){if(o&&o.namespace){a[e]||t(e);var i=o,c=a[e],u=i.namespace;i.moduleName=e;var R=r(c,u),f=e+"."+i.namespace,O=/[.]/.test(u)?i.namespace.match(/[.][^.]+$/)[0].substr(1):u;E[f]||n(R,O,f,i);var g=i.runCode;!g&&d&&(g=d);var v=new s(i,g),m=E[f]||{},_={};E[f]={},l.forEach(function(e){i.os&&-1!==i.os.indexOf(e)?(E[f][e]=v,_[e]=!0):(E[f][e]=m[e],i.os&&i.os.push(e))}),Object.keys(_).forEach(function(e){m[e]&&m[e].dispose()})}}var a=e,s=a.Proxy,c=a.globalError,u=a.showError,R=a.os,d=a.callInner,E={},f={},l=["quick","dd","h5"];a.extendModule=function(e,o){if(o&&Array.isArray(o)){a[e]||t(e);for(var r=0,n=o.length;r<n;r+=1)i(e,o[r])}},a.extendApi=i}function f(e){function o(e){var o=r.getPromise(),t=e||{},i=function(e,o){n({handlerName:t.name,proto:t.mudule,data:t.data||{},success:t.success,error:t.error,isLongCb:t.isLongCb,isEvent:t.isEvent},e,o)};return o&&new o(i)||i()}var r=e,n=R(r.JSBridge);r.callApi=o,r.callNativeApi=o}function l(e){function o(){r.runtime&&r.runtime.getQuickVersion?r.runtime.getQuickVersion({success:function(e){var o=e.version;u(r.version,o)<0&&i(t.ERROR_TYPE_VERSIONNEEDUPGRADE.code,t.ERROR_TYPE_VERSIONNEEDUPGRADE.msg)},error:function(){i(t.ERROR_TYPE_INITVERSIONERROR.code,t.ERROR_TYPE_INITVERSIONERROR.msg)}}):i(t.ERROR_TYPE_VERSIONNOTSUPPORT.code,t.ERROR_TYPE_VERSIONNOTSUPPORT.msg)}var r=e,t=r.globalError,i=r.showError,a=r.JSBridge,s=void 0,R=!1,d=!1;r.config=function(e){if(d)i(t.ERROR_TYPE_CONFIGMODIFY.code,t.ERROR_TYPE_CONFIGMODIFY.msg);else{d=!0;var a=function(){s?(n("ready!"),s()):R=!0};r.os.quick?(o(),r.auth.config(c({success:function(){a()},error:function(e){var o=JSON.stringify(e);i(t.ERROR_TYPE_CONFIGERROR.code,o)}},e))):a()}},r.ready=function(e){s?i(t.ERROR_TYPE_READYMODIFY.code,t.ERROR_TYPE_READYMODIFY.msg):(s=e,R&&(n("ready!"),R=!1,s()))},a.registerHandler("handleError",function(e){i(t.ERROR_TYPE_NATIVE.code,JSON.stringify(e))})}function O(e){var o={};e.innerUtil=o,o.isObject=s}var g={ERROR_TYPE_APIOS:{code:1001,msg:"该API无法在当前OS下运行"},ERROR_TYPE_APIMODIFY:{code:1002,msg:"不允许更改JSSDK的API"},ERROR_TYPE_MODULEMODIFY:{code:1003,msg:"不允许更改JSSDK的模块"},ERROR_TYPE_APINOTEXIST:{code:1004,msg:"调用了不存在的api"},ERROR_TYPE_PROTONOTEXIST:{code:1005,msg:"调用错误，该组件api对应的proto不存在"},ERROR_TYPE_CUSTOMEAPINOTEXIST:{code:1006,msg:"非容器下无法调用自定义组件API"},ERROR_TYPE_EVENTNOTEXIST:{code:1007,msg:"对应的event事件在该环境下不存在"},ERROR_TYPE_INITVERSIONERROR:{code:1008,msg:"初始化版本号错误，请检查容器api的实现情况"},ERROR_TYPE_READYMODIFY:{code:2001,msg:"ready回调不允许多次设置"},ERROR_TYPE_CONFIGMODIFY:{code:2002,msg:"config不允许多次调用"},ERROR_TYPE_CONFIGERROR:{code:2003,msg:"config校验错误"},ERROR_TYPE_VERSIONNOTSUPPORT:{code:2004,msg:"不支持当前容器版本，请确保容器与前端库版本匹配"},ERROR_TYPE_VERSIONNEEDUPGRADE:{code:2005,msg:"当前JSSDK库小于容器版本，请将前端库升级到最新版本"},ERROR_TYPE_NATIVE:{code:3e3,msg:"捕获到一处原生容器错误"},ERROR_TYPE_NATIVECALL:{code:3001,msg:"原生调用H5时参数不对"},ERROR_TYPE_UNKNOWN:{code:9999,msg:"未知错误"}},v=function(){},m={};return function(r){var n=r;e(n),o(n),t(n),i(n),a(n),d(n),E(n),f(n),l(n),O(n)}(m),m.Version="1.0.0",m});