/*!
 * quickhybrid v0.0.1
 * (c) 2017-2017 dailc
 * Released under the BSD-3-Clause License.
 * https://github.com/quickhybrid/quickhybrid
 */
!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):e.quick=o()}(this,function(){"use strict";function e(e){(function(e){this.os={};var o=e.match(/(Android);?[\s/]+([\d.]+)?/);o&&(this.os.android=!0,this.os.version=o[2],this.os.isBadAndroid=!/Chrome\/\d/.test(window.navigator.appVersion));var n=e.match(/(iPhone\sOS)\s([\d_]+)/);n&&(this.os.ios=!0,this.os.iphone=!0,this.os.version=n[2].replace(/_/g,"."));var t=e.match(/(iPad).*OS\s([\d_]+)/);t&&(this.os.ios=!0,this.os.ipad=!0,this.os.version=t[2].replace(/_/g,"."));var r=e.match(/QuickHybrid/i);r&&(this.os.quick=!0);var i=e.match(/EpointEJS/i);i&&(this.os.ejs=!0);var a=e.match(/DingTalk/i);a&&(this.os.dd=!0),i||a||r||(this.os.h5=!0)}).call(e,navigator.userAgent)}function o(e){var o=e;o.Promise=window.Promise,o.getPromise=function(){return o.Promise},o.setPromise=function(e){o.Promise=e}}function n(e){console.error("[quick error]: "+e)}function t(e){console.log("[quick log]: "+e)}function r(e){var o=e,t=void 0;o.showError=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\u9519\u8bef!";n("code:"+e+", msg:"+o),t&&t({code:e,message:o})},o.globalError=_,o.error=function(e){t=e}}function i(e){function o(e,o){this.api=e,this.callback=o}var n=e;o.prototype.walk=function(){var e=this,o=n.getPromise();return function(){for(var n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];var i=t;i[0]=i[0]||{},e.api.defaultParams&&i[0]instanceof Object&&Object.keys(e.api.defaultParams).forEach(function(o){void 0===i[0][o]&&(i[0][o]=e.api.defaultParams[o])});var a=void 0;return e.callback&&(a=e.callback),o?a&&new o(function(o,n){i=i.concat([o,n]),a.apply(e,i)}):a&&a.apply(e,i)}},o.prototype.dispose=function(){this.api=null,this.callback=null},n.Proxy=o}function a(e){function o(){return Math.floor(Math.random()*g)}function t(e){return"string"!=typeof e?JSON.stringify(e):e}function r(e,o){var n=l+"://"+e,r=void 0,i=void 0,a=void 0;return o.callbackId&&(r=o.callbackId,i=o.handlerName,a=o.data),a=encodeURIComponent(t(a)),n+=":"+r+"/"+i+"?"+a}function i(e,t,i){var a=t;if("function"==typeof i){var s=o();f[s]=i,a.callbackId=s}else a.callbackId=i;var c=r(e,a);d.quick?d.ios?window.webkit.messageHandlers.WKWebViewJavascriptBridge.postMessage(c):window.top.prompt(c,""):n("\u6d4f\u89c8\u5668\u4e2djsbridge\u65e0\u6548,\u5bf9\u5e94scheme:"+c)}var a=e,s={},c=a.showError,u=a.globalError,d=a.os;a.JSBridge=s;var l="QuickHybridJSBridge",R={},f={},E={},g=2147483647;s.registerHandler=function(e,o){R[e]=o},s.registerLongCallback=function(e,o){E[e]=o},s.getLongCallbackId=function(){return g-=1},s.callHandler=function(e,o,n,t){i(e,{handlerName:o,data:n},t)},s._handleMessageFromNative=function(e){setTimeout(function(){var o=void 0;try{"string"==typeof e?(o=decodeURIComponent(e),o=JSON.parse(o)):o=e}catch(e){return void c(u.ERROR_TYPE_NATIVECALL.code,u.ERROR_TYPE_NATIVECALL.msg)}var n=o.responseId,t=o.responseData,r=void 0;if(n)(r=(r=f[n])||E[n])&&r(t),delete f[n];else{var i=R[o.handlerName],a=o.data;i&&i(a)}})}}function s(e){return"Object"===Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]}function c(e){for(var o=e,n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return t.forEach(function(e){Object.keys(e).forEach(function(n){o[n]=e[n]})}),o}function u(e,o){if("string"!=typeof e||"string"!=typeof o)throw new Error("version need to be string type");for(var n=e.split("."),t=o.split("."),r=Math.max(n.length,t.length),i=0;i<r;i+=1){var a=n[i]||0,s=t[i]||0;if(a-=0,s-=0,a>s)return 1;if(a<s)return-1}return 0}function d(e){return function(o,n,t){var r=o.success,i=o.error,a=o.dataFilter,s=o.proto,c=o.handlerName,u=o.isLongCb,d=o.isEvent,l=o.data,R=function(e){if(0===e.code)i&&i(e),!u&&t&&t(e);else{var o=e;a&&(o=a(o)),r&&r(o.result),!u&&n&&n(o.result)}};if(u){var f=e.getLongCallbackId();d&&(l.port=f),e.registerLongCallback(f,R),e.callHandler(s,c,l,f),n&&n()}else e.callHandler(s,c,l,R)}}function l(e){var o=e,n=o.os,t=d(o.JSBridge);o.callInner=function(e,o,r){var i=c({},e);i.success=void 0,i.error=void 0,i.dataFilter=void 0,n.quick&&t({handlerName:this.api.namespace,data:i,proto:this.api.moduleName,success:e.success,error:e.error,dataFilter:e.dataFilter,isLongCb:this.api.isLongCb,isEvent:this.api.isEvent},o,r)}}function R(e){function o(e){for(var o=0,n=E.length;o<n;o+=1)if(e[E[o]])return E[o];return"h5"}function n(e,o){var n=e;return(/[.]/.test(o)?o.replace(/[.][^.]+$/,"").split("."):[]).forEach(function(e){n[e]=n[e]||{},n=n[e]}),n}function t(e,n,t,r){Object.defineProperty(e,n,{configurable:!0,enumerable:!0,get:function(){var e=R[t][o(d)];if(e)return e.walk();var n=r.os?r.os.join("\u6216"):'"\u975e\u6cd5"',i=r.namespace+"\u8981\u6c42\u7684os\u73af\u5883\u4e3a:"+n;return u(c.ERROR_TYPE_APIOS.code,i),T},set:function(){u(c.ERROR_TYPE_APIMODIFY.code,c.ERROR_TYPE_APIMODIFY.msg)}})}function r(e){Object.defineProperty(a,e,{configurable:!0,enumerable:!0,get:function(){return f[e]||(f[e]={}),f[e]},set:function(){u(c.ERROR_TYPE_MODULEMODIFY.code,c.ERROR_TYPE_MODULEMODIFY.msg)}})}function i(e,o){if(o&&o.namespace){a[e]||r(e);var i=o,c=a[e],u=i.namespace;i.moduleName=e;var d=n(c,u),f=e+"."+i.namespace,g=/[.]/.test(u)?i.namespace.match(/[.][^.]+$/)[0].substr(1):u;R[f]||t(d,g,f,i);var m=i.runCode;!m&&l&&(m=l);var O=new s(i,m),v=R[f]||{},h={};R[f]={},E.forEach(function(e){i.os&&-1!==i.os.indexOf(e)?(R[f][e]=O,h[e]=!0):(R[f][e]=v[e],i.os&&i.os.push(e))}),Object.keys(h).forEach(function(e){v[e]&&v[e].dispose()})}}var a=e,s=a.Proxy,c=a.globalError,u=a.showError,d=a.os,l=a.callInner,R={},f={},E=["quick","dd","h5"];a.extendModule=function(e,o){if(o&&Array.isArray(o)){a[e]||r(e);for(var n=0,t=o.length;n<t;n+=1)i(e,o[n])}},a.extendApi=i}function f(e){function o(e){var o=n.getPromise(),r=e||{},i=function(e,o){t({handlerName:r.name,proto:r.mudule,data:r.data||{},success:r.success,error:r.error,isLongCb:r.isLongCb,isEvent:r.isEvent},e,o)};return o&&new o(i)||i()}var n=e,t=d(n.JSBridge);n.callApi=o,n.callNativeApi=o}function E(e){function o(){n.runtime&&n.runtime.getQuickVersion?n.runtime.getQuickVersion({success:function(e){var o=e.version;u(n.version,o)<0&&i(r.ERROR_TYPE_VERSIONNEEDUPGRADE.code,r.ERROR_TYPE_VERSIONNEEDUPGRADE.msg)},error:function(){i(r.ERROR_TYPE_INITVERSIONERROR.code,r.ERROR_TYPE_INITVERSIONERROR.msg)}}):i(r.ERROR_TYPE_VERSIONNOTSUPPORT.code,r.ERROR_TYPE_VERSIONNOTSUPPORT.msg)}var n=e,r=n.globalError,i=n.showError,a=n.JSBridge,s=void 0,d=!1,l=!1;n.config=function(e){if(l)i(r.ERROR_TYPE_CONFIGMODIFY.code,r.ERROR_TYPE_CONFIGMODIFY.msg);else{l=!0;var a=function(){s?(t("ready!"),s()):d=!0};n.os.quick?(o(),n.auth.config(c({success:function(){a()},error:function(e){var o=JSON.stringify(e);i(r.ERROR_TYPE_CONFIGERROR.code,o)}},e))):a()}},n.ready=function(e){s?i(r.ERROR_TYPE_READYMODIFY.code,r.ERROR_TYPE_READYMODIFY.msg):(s=e,d&&(t("ready!"),d=!1,s()))},a.registerHandler("handleError",function(e){i(r.ERROR_TYPE_NATIVE.code,JSON.stringify(e))})}function g(e){e.extendModule("auth",[{namespace:"getToken",os:["quick"]},{namespace:"refreshToken",os:["quick"]},{namespace:"getUserInfo",os:["quick"]},{namespace:"config",os:["quick"],defaultParams:{jsApiList:[]}}])}function m(e){e.extendModule("runtime",[{namespace:"getAppVersion",os:["quick"]},{namespace:"getQuickVersion",os:["quick"]}])}function O(e){e.extendModule("ui",[{namespace:"alert",os:["quick"],defaultParams:{title:"",message:"",buttonName:"\u786e\u5b9a"}}])}function v(e){g(e),m(e),O(e)}function h(e){e.extendModule("ui",[{namespace:"alert",os:["h5"],defaultParams:{title:"",message:"",buttonName:"\u786e\u5b9a"},runCode:function(){var e=arguments.length<=0?void 0:arguments[0],o=arguments.length<=1?void 0:arguments[1],n=arguments.length<=2?void 0:arguments[2];s(e)||(e={message:arguments.length<=0?void 0:arguments[0],title:"",buttonName:"\u786e\u5b9a"},"string"==typeof(arguments.length<=1?void 0:arguments[1])&&(e.title=arguments.length<=0?void 0:arguments[0],e.message=arguments.length<=1?void 0:arguments[1],"string"==typeof(arguments.length<=2?void 0:arguments[2])?(e.buttonName=arguments.length<=2?void 0:arguments[2],o=arguments.length<=3?void 0:arguments[3],n=arguments.length<=4?void 0:arguments[4]):(o=arguments.length<=2?void 0:arguments[2],n=arguments.length<=3?void 0:arguments[3]))),window.alert?(window.alert(e.message,e.title,e.buttonName),e.success&&e.success({}),o&&o({})):(e.error&&e.error({}),n&&n({}))}}])}function p(e){h(e)}function P(e){v(e),p(e)}var _={ERROR_TYPE_APIOS:{code:1001,msg:"\u8be5API\u65e0\u6cd5\u5728\u5f53\u524dOS\u4e0b\u8fd0\u884c"},ERROR_TYPE_APIMODIFY:{code:1002,msg:"\u4e0d\u5141\u8bb8\u66f4\u6539JSSDK\u7684API"},ERROR_TYPE_MODULEMODIFY:{code:1003,msg:"\u4e0d\u5141\u8bb8\u66f4\u6539JSSDK\u7684\u6a21\u5757"},ERROR_TYPE_APINOTEXIST:{code:1004,msg:"\u8c03\u7528\u4e86\u4e0d\u5b58\u5728\u7684api"},ERROR_TYPE_PROTONOTEXIST:{code:1005,msg:"\u8c03\u7528\u9519\u8bef\uff0c\u8be5\u7ec4\u4ef6api\u5bf9\u5e94\u7684proto\u4e0d\u5b58\u5728"},ERROR_TYPE_CUSTOMEAPINOTEXIST:{code:1006,msg:"\u975e\u5bb9\u5668\u4e0b\u65e0\u6cd5\u8c03\u7528\u81ea\u5b9a\u4e49\u7ec4\u4ef6API"},ERROR_TYPE_EVENTNOTEXIST:{code:1007,msg:"\u5bf9\u5e94\u7684event\u4e8b\u4ef6\u5728\u8be5\u73af\u5883\u4e0b\u4e0d\u5b58\u5728"},ERROR_TYPE_INITVERSIONERROR:{code:1008,msg:"\u521d\u59cb\u5316\u7248\u672c\u53f7\u9519\u8bef\uff0c\u8bf7\u68c0\u67e5\u5bb9\u5668api\u7684\u5b9e\u73b0\u60c5\u51b5"},ERROR_TYPE_READYMODIFY:{code:2001,msg:"ready\u56de\u8c03\u4e0d\u5141\u8bb8\u591a\u6b21\u8bbe\u7f6e"},ERROR_TYPE_CONFIGMODIFY:{code:2002,msg:"config\u4e0d\u5141\u8bb8\u591a\u6b21\u8c03\u7528"},ERROR_TYPE_CONFIGERROR:{code:2003,msg:"config\u6821\u9a8c\u9519\u8bef"},ERROR_TYPE_VERSIONNOTSUPPORT:{code:2004,msg:"\u4e0d\u652f\u6301\u5f53\u524d\u5bb9\u5668\u7248\u672c\uff0c\u8bf7\u786e\u4fdd\u5bb9\u5668\u4e0e\u524d\u7aef\u5e93\u7248\u672c\u5339\u914d"},ERROR_TYPE_VERSIONNEEDUPGRADE:{code:2005,msg:"\u5f53\u524dJSSDK\u5e93\u5c0f\u4e8e\u5bb9\u5668\u7248\u672c\uff0c\u8bf7\u5c06\u524d\u7aef\u5e93\u5347\u7ea7\u5230\u6700\u65b0\u7248\u672c"},ERROR_TYPE_NATIVE:{code:3e3,msg:"\u6355\u83b7\u5230\u4e00\u5904\u539f\u751f\u5bb9\u5668\u9519\u8bef"},ERROR_TYPE_NATIVECALL:{code:3001,msg:"\u539f\u751f\u8c03\u7528H5\u65f6\u53c2\u6570\u4e0d\u5bf9"},ERROR_TYPE_UNKNOWN:{code:9999,msg:"\u672a\u77e5\u9519\u8bef"}},T=function(){},I={};return function(n){var t=n;e(t),o(t),r(t),i(t),a(t),l(t),R(t),f(t),E(t),P(t)}(I),I.Version="1.0.0",I});